extends layout

head
	script(src="http://code.jquery.com/jquery-1.8.3.js")
	script(src="http://code.jquery.com/ui/1.9.2/jquery-ui.js")
	link(rel="stylesheet", href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css")
	link(rel='stylesheet', href='/stylesheets/style.css')

block content
	h1= title
	p #{book.name}
	div.input-query-container(data-inline=true)
		form(action='/book/#{book.uuid}/transaction', method='POST')
			div.input-fields-container
				div.fields(data-role='fieldcontain')
					fieldset(data-role='controlgroup')
						label Type:
							select(name='type')
								- for v, t in types
									option(value=t) #{v}
				div.fields(data-role='fieldcontain')
					fieldset(data-role='controlgroup')
						label tags:
							input(type='text', id='tags', name='tags')
				div.fields(data-role='fieldcontain')
					fieldset(data-role='controlgroup')
						label money:
							input(type='text', id='money', name='money')
				div.fields(data-role='fieldcontain')
					fieldset(data-role='controlgroup')
						label Account:
							input(type='text', id='account', name='account')
				div.fields(data-role='fieldcontain', visibility=true)
					fieldset(data-role='controlgroup')
						label Account:
							input(type='text', id='target', name='target')
				div.fields(data-role='fieldcontain')
					fieldset(data-role='controlgroup')
						label description:
							input(type='text', id='description', name='description')
				div.clear
			div.input-query-submit
				div(data-role='fieldcontain)
					fieldset(data-role='controlgroup')
						label +:
							input(type='submit', value='Go!')
			div.clear

	div(data-inline=true, id='tabs', class=['list-canvas ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-vertical ui-helper-clearfix'])
		ul(class=['ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all'])
			li(class=['ui-state-default ui-tabs-active ui-state-active ui-corner-left'])
				a(class=['ui-tabs-anchor'], href='/book/#{book.uuid}') All accounts
			for account in accounts
				li(class=['ui-state-default ui-tabs-active ui-state-active ui-corner-left'])
					a(class=['ui-tabs-anchor'], href='/book/#{book.uuid}/#{account.name}') #{account.name}

		div(data-inline=true, class=['list ui-tabs-panel ui-widget-content ui-corner-bottom'])
			div(class='row')
				div(class='view')
					div(class='head')
						div(class='type') Type
						div(class='amount') Amount
						div(class='sum') Sum
						div(class='tags') Tags
						div(class='description') Description
			- var sum = 0 
			for transaction in transactions
				- var typeClass
				case transaction.type
					when 'Expense'
						- sum -= transaction.money
						- typeClass = 'expense'
					when 'Income'
						- sum += transaction.money
						- typeClass = 'income'
					when 'BalanceReset'
						- sum = transaction.money
						- typeClass = 'reset'
					when 'Transfer'
						div.tranfer
						- sum +=0
						- typeClass = 'transfer'
				div(class='row')
					div(class='view')
						div(data-inline=true, class=[typeClass])
							div(class=['type'])
								| #{transaction.type}
							div(class=['amount'])
								| #{transaction.money}
							div(class=['sum'])
								| #{sum}
							div(class=['tags'])
								- var tags = transaction.tags_array
								for tag in tags
									span #{tag}
							div(class=['description'])
								| #{transaction.description}